<html>
    <head>
        <title>wad js test</title>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
        
    </head>
    <body>
        <input type="file" id="fileInput">
        <script type="text/javascript" src="wad.js"></script>
        <br>
        <table><tr><td valign="top"><div id="lumpList"></div></td><td valign="top"><div id="preview"></td></tr></table>
        <script>
            
            var self = this;
            var lumpnames = ["a","b","c"];
            var fileInput = document.getElementById('fileInput');
            var fileDisplayArea = document.getElementById('test');
            var lumpList = null;
            
            function makeUL(array) {
                // Create the list element:
                var list = document.createElement('ul');
                list.id = "lumpUL";

                for(var i = 0; i < array.length; i++) {
                    // Create the list item:
                    var item = document.createElement('li');

                    // Set its contents:
                    item.appendChild(document.createTextNode(array[i]));

                    // Add it to the list:
                    list.appendChild(item);
                }

                // Finally, return the constructed list:
                return list;
            }

            fileInput.addEventListener('change', function(e) {
                
                if (self.lumpList) self.lumpList.destructor();
                self.lumpnames = [];
            
                var file = fileInput.files[0];
                
                wad = Object.create(Wad);
                
                wad.onLoad = function(e) {
                    for (var i = 0; i < wad.lumps.length; i++) {
                        self.lumpnames.push(wad.lumps[i].name);
                    }
                    
                    $('#lumpList').html(makeUL(self.lumpnames));
                    
                    $('#lumpUL').delegate('li', 'click', function (e) {
                        $('#preview').html(wad.getLumpAsText(e.currentTarget.textContent));
                    });
                };
                
                wad.load(file);
            });
            
            
        
            
        
        </script>
        
    </body>
</html>