function makeUL(a){var b=document.createElement("ol");b.id="lumpUL";for(var c=0;c<a.length;c++){var d=document.createElement("li"),e=document.createElement("span");e.innerHTML+=getIcon(a[c][0]);var f=document.createTextNode(" "+a[c][1]);e.appendChild(f),d.appendChild(e),d.id="item",b.appendChild(d)}return b}function createAudioPreview(a){var b=document.createElement("div");textnode=document.createTextNode("Artist - Title"),b.appendChild(textnode);var c=new Blob([a]);audioEl=new Audio(URL.createObjectURL(c)),audioEl.controls=!0,console.log(audioEl),$("#preview").append(b),$("#preview").append(audioEl)}function createTextPreview(a){var b=document.createElement("div");b.style="overflow: auto;";var c=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;b.style.height=.9*c,textnode=document.createTextNode(a),b.appendChild(textnode),$("#preview").append(b)}function createImagePreview(a){var b=new Blob([a]);imageEl=new Image,imageEl.src=URL.createObjectURL(b),$("#preview").append(imageEl)}function createMIDIPreview(a){var b=URL.createObjectURL(new Blob([a])),c=function(){MIDIjs.play(b)},d=function(){MIDIjs.stop()},e=document.createElement("button");e.innerHTML='<i class="material-icons">play_arrow</i>',e.onclick=c,$("#preview").append(e);var f=document.createElement("button");f.innerHTML='<i class="material-icons">stop</i>',f.onclick=d,$("#preview").append(f)}function initWad(){self.errormsg=null,$(errors).html(""),$("#preview").hide(),$("#lumpTable").hide(),$("#loading").show(),progress=0,self.lumpList&&self.lumpList.destructor(),self.lumpnames=[],wad=Object.create(Wad),wad.onProgress=updateLoading,wad.onLoad=wadOnLoad}function loadURL(){initWad(),wad.loadURL(document.getElementById("urlInput").value)}function getIcon(a){return a==MAP?'<img src="icons/map.png">':a==MAPDATA?'<img src="icons/mapdata.png">':a==TEXT?'<img src="icons/text.png">':a==PLAYPAL?'<img src="icons/playpal.png">':a==ENDOOM?'<img src="icons/endoom.png">':a==COLORMAP?'<img src="icons/colormap.png">':a==MUSIC?'<img src="icons/music.png">':a==MIDI?'<img src="icons/midi.png">':a==MP3?'<img src="icons/mp3.png">':a==GRAPHIC?'<img src="icons/graphic.png">':a==FLAT?'<img src="icons/flat.png">':a==PNG?'<img src="icons/png.png">':a==MUS?'<img src="icons/mus.png">':a==MARKER?'<img src="icons/marker.png">':a==PNAMES?'<img src="icons/pnames.png">':TEXTUREx.indexOf(a)>=0?'<img src="icons/texturex.png">':'<img src="icons/unknown.png">'}function wadOnLoad(a){if($("#loading").hide(),null!=self.errormsg)$(errors).html(self.errormsg);else{for(var b=0;b<wad.lumps.length;b++)self.lumpnames.push([wad.detectLumpType(b),wad.lumps[b].name]);$("#lumpTable").show(),$("#lumpList").html(makeUL(self.lumpnames)),$("#lumpUL").delegate("li","click",function(a){for($("#preview").html(""),$("#preview").show();"item"!=a.target.id;)a.target=a.target.parentNode;for(var b=a.target,c=0;b.previousElementSibling;)b=b.previousElementSibling,c+=1;switch(lumptype=wad.detectLumpType(c),lumptype){case PNG:$("#preview").html(""),createImagePreview(wad.getLump(c));break;case MP3:case MUSIC:$("#preview").html(""),createAudioPreview(wad.getLump(c));break;case MIDI:$("#preview").html(""),createMIDIPreview(wad.getLump(c));break;case TEXT:$("#preview").html(""),createTextPreview(wad.getLumpAsText(c));break;case PLAYPAL:playpal=Object.create(Playpal),playpal.load(wad.getLump(c)),$("#preview").html(""),document.getElementById("preview").appendChild(playpal.toCanvas());break;case COLORMAP:colormap=Object.create(Colormap),colormap.load(wad.getLump(c)),$("#preview").html(""),document.getElementById("preview").appendChild(colormap.toCanvas(wad));break;case FLAT:flat=Object.create(Flat),flat.load(wad.getLump(c)),$("#preview").html(""),document.getElementById("preview").appendChild(flat.toCanvas(wad));break;case GRAPHIC:graphic=Object.create(Graphic),graphic.load(wad.getLump(c)),$("#preview").html(""),document.getElementById("preview").appendChild(graphic.toCanvas(wad));break;case ENDOOM:endoom=Object.create(Endoom),endoom.onLoad=function(){$("#preview").html(""),document.getElementById("preview").appendChild(endoom.toCanvas())},endoom.load(wad.getLump(c)),$("#preview").html("");break;case MAP:map=Object.create(MapData),map.load(wad,wad.lumps[c].name),$("#preview").html("");var d=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;document.getElementById("preview").appendChild(map.toCanvas(.8*(d-$("#lumpList").width()),.8*e));break;case MAPDATA:switch(mapdata=Object.create(MapData),wad.lumps[c].name){case"VERTEXES":mapdata.parseVertexes(wad.getLump(c)),$("#preview").html("Total vertexes: "+mapdata.vertexes.length.toString());break;case"LINEDEFS":mapdata.parseLinedefs(wad.getLump(c)),$("#preview").html("Total linedefs: "+mapdata.linedefs.length.toString());break;case"SIDEDEFS":mapdata.parseSidedefs(wad.getLump(c)),$("#preview").html("Total sidedefs: "+mapdata.sidedefs.length.toString());break;case"SECTORS":mapdata.parseSectors(wad.getLump(c)),$("#preview").html("Total sectors: "+mapdata.sectors.length.toString());break;case"THINGS":mapdata.parseThings(wad.getLump(c));var f=mapdata.getThingTable(),g="";console.log(mapdata.getDoomThingName(1));for(var h in f)f.hasOwnProperty(h)&&(console.log(h),g+=mapdata.getDoomThingName(parseInt(h)),g+="s: "+f[h]+"<br>");$("#preview").html("Total things: "+mapdata.things.length.toString()+"<p>"+g);break;default:$("#preview").html("Unable to preview "+wad.lumps[c].name+" lumps")}break;case"...":$("#preview").html("Unable to preview this lump, and can't detect it's type<br>");var i=document.createElement("button");i.onclick=function(){$("#preview").html(""),createTextPreview(self.wad.getLumpAsText(c))},i.innerHTML="View as text",$("#preview").append(i);break;default:$("#preview").html("Unable to preview "+lumptype+" lumps")}})}}var self=this,lumpnames=["a","b","c"],fileInput=document.getElementById("fileInput"),fileDisplayArea=document.getElementById("test"),lumpList=null,loadingInterval,errors=document.getElementById("errors");$("#preview").hide(),$("#lumpTable").hide(),$("#loading").hide();var progress=0,wad=Object.create(Wad);fileInput.addEventListener("change",function(a){initWad();var b=fileInput.files[0];console.log(b),wad.load(b)});var updateLoading=function(a){progress+=8;for(var b=35*progress/wad.numlumps,c="[",d=0;d<b;d++)c+=".";for(d=b;d<35;d++)c+="&nbsp;";document.getElementById("loading").innerHTML=c+"]"};